<!doctype html>
<html lang="en">
<head>
  <title>Book Appointment | Harmony HomeoCare</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/static/style.css">
  <link rel="icon" type="image/png"
      href="{{ url_for('static', filename='favicon.png') }}">

</head>

<body>

<header>
  <h2 class="page-title">Book Your Appointment</h2>
</header>

<main class="content">
  <div class="container">

    <!-- FLASH MESSAGES -->
    {% with messages = get_flashed_messages(with_categories=true) %}
  {% for category, msg in messages %}
    {% if category.startswith('patient-') %}
      <div class="flash {{ category }}">{{ msg }}</div>
    {% endif %}
  {% endfor %}
{% endwith %}


    <form method="post" action="/book" class="fade-in">

      <!-- ================= PATIENT DETAILS ================= -->
      <h3>Patient Details</h3>

      <input name="patient_name" placeholder="Full Name" required>

      <input
        name="mobile"
        placeholder="Mobile Number"
        pattern="[0-9]{10}"
        title="Enter 10 digit mobile number"
        required>

      <textarea
        name="address"
        placeholder="Postal Address"
        required></textarea>

      <!-- ================= CONSULTATION TYPE ================= -->
      <h3>Consultation Type</h3>

      <div class="toggle-row">
        <span>First Consultation</span>

        <label class="switch">
          <input type="checkbox" id="followupToggle">
          <span class="slider"></span>
        </label>

        <span>Follow-up</span>
      </div>

      <!-- Hidden value sent to backend -->
      <input type="hidden" name="consultation_type" id="consultationType" value="FIRST">

      <p class="fee-note">
        Consultation Fee:
        <strong id="feeDisplay">₹500</strong>
      </p>

      <!-- ================= SLOT SELECTION ================= -->
      <h3>Select Available Slot</h3>

      <select name="slot_id" id="slotSelect" required>
        <option value="">Loading slots…</option>
      </select>

      <button type="submit" class="primary-btn">
        Reserve Appointment
      </button>

    </form>
  </div>
</main>

<footer class="footer">
  © 2026 Harmony HomeoCare • Online Homeopathy Consultation
</footer>

<!-- ================= JS ================= -->
<script>
const slotSelect = document.getElementById("slotSelect");
const feeDisplay = document.getElementById("feeDisplay");
const toggle = document.getElementById("followupToggle");
const consultType = document.getElementById("consultationType");

const FIRST_FEE = 500;
const FOLLOWUP_FEE = 300;

// -------- Toggle Logic --------
toggle.addEventListener("change", () => {
  if (toggle.checked) {
    consultType.value = "FOLLOWUP";
    feeDisplay.innerText = `₹${FOLLOWUP_FEE}`;
  } else {
    consultType.value = "FIRST";
    feeDisplay.innerText = `₹${FIRST_FEE}`;
  }
});

// -------- Load Slots (future only) --------
function loadSlots() {
  fetch("/slots")
    .then(r => r.json())
    .then(slots => {
      slotSelect.innerHTML = "<option value=''>Select Slot</option>";

      const today = new Date().toISOString().split("T")[0];

      slots.forEach(s => {
        if (s.slot_date >= today) {
          const opt = document.createElement("option");
          opt.value = s.id;
          opt.textContent =
            `${s.slot_date} | ${s.start_time} - ${s.end_time}`;
          slotSelect.appendChild(opt);
        }
      });

      if (slotSelect.options.length === 1) {
        slotSelect.innerHTML =
          "<option value=''>No upcoming slots available</option>";
      }
    });
}

loadSlots();

// -------- Auto refresh slots --------
setInterval(() => {
  if (!document.activeElement.matches("input, textarea, select")) {
    loadSlots();
  }
}, 30000);
</script>

</body>
</html>
